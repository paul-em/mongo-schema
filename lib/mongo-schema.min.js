var MongoSchema=function(){function e(e){return!r(e)||d(e)||f(e.default)?void 0:e.default}function n(e){return r(e)&&e.name?(e=e.name.toLowerCase(),-1!==c.indexOf(e)?e:!1):s(e)?(e=e.toLowerCase(),-1!==c.indexOf(e)?e:!1):!1}function t(e){return r(e)&&!d(e)&&!i(e)&&!f(e.type)}function i(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){return e===Object(e)}function o(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return o(e)&&e!=+e}function d(e){return null===e}function f(e){return void 0===e}function s(e){return"string"==typeof e||"[object String]"==Object.prototype.toString.call(e)}var a=this,c=["string","number","boolean","objectid","date"],l={string:function(){return""},number:function(){return 0},"boolean":function(){return!0},objectid:function(){return""},date:function(){return Math.floor(+new Date/1e3)}};this.check=function(e,c,l){var h,g={},m=[];for(var p in c)if(c.hasOwnProperty(p)){var v=e[p],x=c[p];if(i(x))if(r(v)&&!i(v))h=a.check(v,x[0],l),g[p]=h.data,m=m.concat(h.errors);else if(i(v)){g[p]=[];for(var _ in v)v.hasOwnProperty(_)&&(h=a.check(v[_],x[0],l),g[p][_]=h.data,m=m.concat(h.errors))}else l||(g[p]=[]);else if(!r(x)||d(x)||t(x)||n(x)){var b;if(t(x)?b=x.type:(b=x,x={}),d(v)&&l&&!x.required){g[p]=null;continue}if(f(v)&&l&&!x.required)continue;var q=n(b);if(!q)throw new Error("type "+b+" not available");switch(q){case"string":if(!s(v)&&!o(v)||u(v))v=void 0,x.required&&m.push(p+" - required not set on '"+v+"'");else{if(v+="",!f(x.minLength)&&v.length<x.minLength){x.required&&m.push(p+" - minLength "+x.minLength+" not fulfilled on '"+v+"'");continue}if(!f(x.maxLength)&&v.length>x.maxLength&&(x.required&&m.push(p+" - maxLength "+x.regex+" not fulfilled on '"+v+"'"),v=v.substr(0,x.maxLength)),!f(x.regex)&&!x.regex.test(v)){x.required&&m.push(p+" - regex "+x.regex+" not fulfilled '"+v+"'");continue}}f(v)||(g[p]=v);continue;case"number":if((i(v)||d(v))&&(v=void 0),v=1*v,u(v)&&(v=void 0),x.required&&f(v)){m.push(p+" - required not set on '"+v+"'");continue}if(!f(v)&&!f(x.min)&&v<x.min){x.required&&m.push(p+" - min "+x.min+" not fulfilled '"+v+"'");continue}if(!f(v)&&!f(x.max)&&v>x.max){x.required&&m.push(p+" - max "+x.max+" not fulfilled on '"+v+"'");continue}f(v)||(g[p]=v);continue;case"boolean":if(x.required&&f(v)){m.push(p+" - required not set '"+v+"'");continue}if(f(v))continue;g[p]=!!v;continue;case"date":if(v instanceof Date&&(v=Math.floor(v.getTime()/1e3)),v=1*v,u(v)?v=void 0:(13===v.toString().length&&(v=Math.floor(v/1e3)),10!==v.toString().length&&(v=void 0)),x.required&&f(v)){m.push(p+" - required not set on '"+v+"'");continue}f(v)||(g[p]=v);continue;case"objectid":if(("string"!=typeof v||"string"==typeof v&&24!==v.length)&&(v=void 0),x.required&&f(v)){m.push(p+" - required not set '"+v+"'");continue}f(v)||(g[p]=v);continue}}else f(v)||(h=a.check(v,x,l),g[p]=h.data,m=m.concat(h.errors))}return{errors:m,data:g}},this.defaults=function(o){var u={};for(var s in o)if(o.hasOwnProperty(s)){var c=o[s];if(i(c))u[s]=[];else if(!r(c)||d(c)||t(c)||n(c)){if(c){var h;t(c)?h=c.type:(h=c,c={}),h=n(h),u[s]=!c.required&&f(e(c))||f(l[h])?void 0:e(c)||l[h]()}}else u[s]=a.defaults(c)}return u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports.check=mongoSchema.check,exports.defaults=mongoSchema.defaults}var MongoSchema=function(){function e(e){return!r(e)||d(e)||f(e.default)?void 0:e.default}function n(e){return r(e)&&e.name?(e=e.name.toLowerCase(),-1!==c.indexOf(e)?e:!1):s(e)?(e=e.toLowerCase(),-1!==c.indexOf(e)?e:!1):!1}function t(e){return r(e)&&!d(e)&&!i(e)&&!f(e.type)}function i(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){return e===Object(e)}function o(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return o(e)&&e!=+e}function d(e){return null===e}function f(e){return void 0===e}function s(e){return"string"==typeof e||"[object String]"==Object.prototype.toString.call(e)}var a=this,c=["string","number","boolean","objectid","date"],l={string:function(){return""},number:function(){return 0},"boolean":function(){return!0},objectid:function(){return""},date:function(){return Math.floor(+new Date/1e3)}};this.check=function(e,c,l){var h,g={},m=[];for(var p in c)if(c.hasOwnProperty(p)){var v=e[p],x=c[p];if(i(x)){if(g[p]=[],i(v))for(var _ in v)v.hasOwnProperty(_)&&(h=a.check(v[_],x[0]),g[p][_]=h.data,m=m.concat(h.errors))}else if(!r(x)||d(x)||t(x)||n(x)){var b;if(t(x)?b=x.type:(b=x,x={}),d(v)&&l&&!x.required){g[p]=void 0;continue}var q=n(b);if(!q)throw new Error("type "+b+" not available");switch(q){case"string":if(!s(v)&&!o(v)||u(v))v=void 0,x.required&&m.push(p+" - required not set on '"+v+"'");else{if(v+="",!f(x.minLength)&&v.length<x.minLength){x.required&&m.push(p+" - minLength "+x.minLength+" not fulfilled on '"+v+"'");continue}if(!f(x.maxLength)&&v.length>x.maxLength&&(x.required&&m.push(p+" - maxLength "+x.regex+" not fulfilled on '"+v+"'"),v=v.substr(0,x.maxLength)),!f(x.regex)&&!x.regex.test(v)){x.required&&m.push(p+" - regex "+x.regex+" not fulfilled '"+v+"'");continue}}f(v)||(g[p]=v);continue;case"number":if((i(v)||d(v))&&(v=void 0),v=1*v,u(v)&&(v=void 0),x.required&&f(v)){m.push(p+" - required not set on '"+v+"'");continue}if(!f(v)&&!f(x.min)&&v<x.min){x.required&&m.push(p+" - min "+x.min+" not fulfilled '"+v+"'");continue}if(!f(v)&&!f(x.max)&&v>x.max){x.required&&m.push(p+" - max "+x.max+" not fulfilled on '"+v+"'");continue}f(v)||(g[p]=v);continue;case"boolean":if(x.required&&f(v)){m.push(p+" - required not set '"+v+"'");continue}if(f(v))continue;g[p]=!!v;continue;case"date":if(v instanceof Date&&(v=Math.floor(v.getTime()/1e3)),v=1*v,u(v)?v=void 0:(13===v.toString().length&&(v=Math.floor(v/1e3)),10!==v.toString().length&&(v=void 0)),x.required&&f(v)){m.push(p+" - required not set on '"+v+"'");continue}f(v)||(g[p]=v);continue;case"objectid":if(("string"!=typeof v||"string"==typeof v&&24!==v.length)&&(v=void 0),x.required&&f(v)){m.push(p+" - required not set '"+v+"'");continue}f(v)||(g[p]=v);continue}}else f(v)||(h=a.check(v,x),g[p]=h.data,m=m.concat(h.errors))}return{errors:m,data:g}},this.defaults=function(o){var u={};for(var s in o)if(o.hasOwnProperty(s)){var c=o[s];if(i(c))u[s]=[];else if(!r(c)||d(c)||t(c)||n(c)){if(c){var h;t(c)?h=c.type:(h=c,c={}),h=n(h),u[s]=!c.required&&f(e(c))||f(l[h])?void 0:e(c)||l[h]()}}else u[s]=a.defaults(c)}return u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports.check=mongoSchema.check,exports.defaults=mongoSchema.defaults}var has_require="undefined"!=typeof require;if("undefined"==typeof _){if(!has_require)throw new Error("mymodule requires underscore, see http://underscorejs.org");_=require("underscore")._}var MongoSchema=function(){function e(e){return _.isObject(e)&&e.name?(e=e.name.toLowerCase(),-1!==i.indexOf(e)?e:!1):_.isString(e)?(e=e.toLowerCase(),-1!==i.indexOf(e)?e:!1):!1}function n(e){return _.isObject(e)&&!_.isNull(e)&&!_.isArray(e)&&!_.isUndefined(e.type)}var t=this,i=["string","number","boolean","objectid","date"];this.check=function(i,r,o){var u=[];return _.each(r,function(r,d){var f=i[d];if(_.isArray(r)){if(!_.isArray(f))return void delete i[d];_.each(f,function(e){u=u.concat(t.check(e,r[0]))})}else if(!_.isObject(r)||_.isNull(r)||n(r)||e(r)){var s;if(n(r)?s=r.type:(s=r,r={}),_.isNull(f)&&o&&!r.required)return void(i[d]=void 0);var a=e(s);if(!a)throw new Error("type "+s+" not available");switch(a){case"string":if(!_.isString(f)&&!_.isNumber(f)||_.isNaN(f))f=void 0,r.required&&u.push(d+" - required not set on '"+f+"'");else{if(f+="",!_.isUndefined(r.minLength)&&f.length<r.minLength)return u.push(d+" - minLength "+r.minLength+" not fulfilled on '"+f+"'"),void delete i[d];if(!_.isUndefined(r.maxLength)&&f.length>r.maxLength&&(u.push(d+" - maxLength "+r.regex+" not fulfilled on '"+f+"'"),f=f.substr(0,r.maxLength)),!_.isUndefined(r.regex)&&!r.regex.test(f))return u.push(d+" - regex "+r.regex+" not fulfilled '"+f+"'"),void delete i[d]}void 0===f?delete i[d]:i[d]=f;break;case"number":if((_.isArray(f)||_.isNull(f))&&(f=void 0),f=1*f,_.isNaN(f)&&(f=void 0),r.required&&_.isUndefined(f))return u.push(d+" - required not set on '"+f+"'"),void delete i[d];if(!_.isUndefined(f)&&!_.isUndefined(r.min)&&f<r.min)return u.push(d+" - min "+r.min+" not fulfilled '"+f+"'"),void delete i[d];if(!_.isUndefined(f)&&!_.isUndefined(r.max)&&f>r.max)return u.push(d+" - max "+r.max+" not fulfilled on '"+f+"'"),void delete i[d];void 0===f?delete i[d]:i[d]=f;break;case"boolean":if(r.required&&_.isUndefined(f))return u.push(d+" - required not set '"+f+"'"),void delete i[d];if(_.isUndefined(f))return void delete i[d];i[d]=!!f;break;case"date":if(f instanceof Date&&(f=Math.floor(f.getTime()/1e3)),f=1*f,_.isNaN(f)?f=void 0:(13===f.toString().length&&(f=Math.floor(f/1e3)),10!==f.toString().length&&(f=void 0)),r.required&&_.isUndefined(f))return u.push(d+" - required not set on '"+f+"'"),void delete i[d];void 0===f?delete i[d]:i[d]=f;break;case"objectid":if(("string"!=typeof f||"string"==typeof f&&24!==f.length)&&(delete i[d],f=void 0),r.required&&_.isUndefined(f))return u.push(d+" - required not set '"+f+"'"),void delete i[d];void 0===f?delete i[d]:i[d]=f}}else{var c=t.check(f,r);u=u.concat(c)}}),u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports=module.exports=function(e,n,t){return mongoSchema.check(e,n,t)}}var has_require="undefined"!=typeof require;if("undefined"==typeof _){if(!has_require)throw new Error("mymodule requires underscore, see http://underscorejs.org");_=require("underscore")._}var MongoSchema=function(){function e(e){return _.isObject(e)&&e.name?(e=e.name.toLowerCase(),-1!==i.indexOf(e)?e:!1):_.isString(e)?(e=e.toLowerCase(),-1!==i.indexOf(e)?e:!1):!1}function n(e){return _.isObject(e)&&!_.isNull(e)&&!_.isArray(e)&&!_.isUndefined(e.type)}var t=this,i=["string","number","boolean","objectid","date"];this.check=function(i,r,o){var u=[];return _.each(r,function(r,d){var f=i[d];if(_.isArray(r)){if(!_.isArray(f))return void delete i[d];_.each(f,function(e){u=u.concat(t.check(e,r[0]))})}else if(!_.isObject(r)||_.isNull(r)||n(r)||e(r)){var s;if(n(r)?s=r.type:(s=r,r={}),_.isNull(f)&&o&&!r.required)return void(i[d]=void 0);var a=e(s);if(!a)throw new Error("type "+s+" not available");switch(a){case"string":if(!_.isString(f)&&!_.isNumber(f)||_.isNaN(f))f=void 0,r.required&&u.push(d+" - required not set on '"+f+"'");else{if(f+="",!_.isUndefined(r.minLength)&&f.length<r.minLength)return u.push(d+" - minLength "+r.minLength+" not fulfilled on '"+f+"'"),void delete i[d];if(!_.isUndefined(r.maxLength)&&f.length>r.maxLength&&(u.push(d+" - maxLength "+r.regex+" not fulfilled on '"+f+"'"),f=f.substr(0,r.maxLength)),!_.isUndefined(r.regex)&&!r.regex.test(f))return u.push(d+" - regex "+r.regex+" not fulfilled '"+f+"'"),void delete i[d]}void 0===f?delete i[d]:i[d]=f;break;case"number":if((_.isArray(f)||_.isNull(f))&&(f=void 0),f=1*f,_.isNaN(f)&&(f=void 0),r.required&&_.isUndefined(f))return u.push(d+" - required not set on '"+f+"'"),void delete i[d];if(!_.isUndefined(f)&&!_.isUndefined(r.min)&&f<r.min)return u.push(d+" - min "+r.min+" not fulfilled '"+f+"'"),void delete i[d];if(!_.isUndefined(f)&&!_.isUndefined(r.max)&&f>r.max)return u.push(d+" - max "+r.max+" not fulfilled on '"+f+"'"),void delete i[d];void 0===f?delete i[d]:i[d]=f;break;case"boolean":if(r.required&&_.isUndefined(f))return u.push(d+" - required not set '"+f+"'"),void delete i[d];if(_.isUndefined(f))return void delete i[d];i[d]=!!f;break;case"date":if(f instanceof Date&&(f=Math.floor(f.getTime()/1e3)),f=1*f,_.isNaN(f)?f=void 0:(13===f.toString().length&&(f=Math.floor(f/1e3)),10!==f.toString().length&&(f=void 0)),r.required&&_.isUndefined(f))return u.push(d+" - required not set on '"+f+"'"),void delete i[d];void 0===f?delete i[d]:i[d]=f;break;case"objectid":if(("string"!=typeof f||"string"==typeof f&&24!==f.length)&&(delete i[d],f=void 0),r.required&&_.isUndefined(f))return u.push(d+" - required not set '"+f+"'"),void delete i[d];void 0===f?delete i[d]:i[d]=f}}else{var c=t.check(f,r);u=u.concat(c)}}),u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports=module.exports=function(e,n,t){return mongoSchema.check(e,n,t)}}
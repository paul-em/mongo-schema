var has_require="undefined"!=typeof require;if("undefined"==typeof _){if(!has_require)throw new Error("mymodule requires underscore, see http://underscorejs.org");_=require("underscore")._}var MongoSchema=function(){function e(e){return _.isObject(e)&&e.name?(e=e.name.toLowerCase(),-1!==r.indexOf(e)?e:!1):_.isString(e)?(e=e.toLowerCase(),-1!==r.indexOf(e)?e:!1):!1}function i(e){return _.isObject(e)&&!_.isNull(e)&&!_.isArray(e)&&!_.isUndefined(e.type)}var n=this,r=["string","number","boolean","objectid","date"];this.check=function(r,t,d){var o=[];return _.each(t,function(t,s){var u=r[s];if(_.isArray(t)){if(!_.isArray(u))return void delete r[s];_.each(u,function(e){o=o.concat(n.check(e,t[0]))})}else if(!_.isObject(t)||_.isNull(t)||i(t)||e(t)){var f;if(i(t)?f=t.type:(f=t,t={}),_.isNull(u)&&d&&!t.required)return void(r[s]=void 0);var a=e(f);if(!a)throw new Error("type "+f+" not available");switch(a){case"string":if(!_.isString(u)&&!_.isNumber(u)||_.isNaN(u))u=void 0,t.required&&o.push(s+" - required not set on '"+u+"'");else{if(u+="",!_.isUndefined(t.minLength)&&u.length<t.minLength)return o.push(s+" - minLength "+t.minLength+" not fulfilled on '"+u+"'"),void delete r[s];if(!_.isUndefined(t.maxLength)&&u.length>t.maxLength&&(o.push(s+" - maxLength "+t.regex+" not fulfilled on '"+u+"'"),u=u.substr(0,t.maxLength)),!_.isUndefined(t.regex)&&!t.regex.test(u))return o.push(s+" - regex "+t.regex+" not fulfilled '"+u+"'"),void delete r[s]}void 0===u?delete r[s]:r[s]=u;break;case"number":if((_.isArray(u)||_.isNull(u))&&(u=void 0),u=1*u,_.isNaN(u)&&(u=void 0),t.required&&_.isUndefined(u))return o.push(s+" - required not set on '"+u+"'"),void delete r[s];if(!_.isUndefined(u)&&!_.isUndefined(t.min)&&u<t.min)return o.push(s+" - min "+t.min+" not fulfilled '"+u+"'"),void delete r[s];if(!_.isUndefined(u)&&!_.isUndefined(t.max)&&u>t.max)return o.push(s+" - max "+t.max+" not fulfilled on '"+u+"'"),void delete r[s];void 0===u?delete r[s]:r[s]=u;break;case"boolean":if(t.required&&_.isUndefined(u))return o.push(s+" - required not set '"+u+"'"),void delete r[s];if(_.isUndefined(u))return void delete r[s];r[s]=!!u;break;case"date":if(u instanceof Date&&(u=Math.floor(u.getTime()/1e3)),u=1*u,_.isNaN(u)?u=void 0:(13===u.toString().length&&(u=Math.floor(u/1e3)),10!==u.toString().length&&(u=void 0)),t.required&&_.isUndefined(u))return o.push(s+" - required not set on '"+u+"'"),void delete r[s];void 0===u?delete r[s]:r[s]=u;break;case"objectid":if(("string"!=typeof u||"string"==typeof u&&24!==u.length)&&(delete r[s],u=void 0),t.required&&_.isUndefined(u))return o.push(s+" - required not set '"+u+"'"),void delete r[s];void 0===u?delete r[s]:r[s]=u}}else{var l=n.check(u,t);o=o.concat(l)}}),o}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports=module.exports=function(e,i,n){return mongoSchema.check(e,i,n)}}var has_require="undefined"!=typeof require;if("undefined"==typeof _){if(!has_require)throw new Error("mymodule requires underscore, see http://underscorejs.org");_=require("underscore")._}var MongoSchema=function(){function e(e){return _.isObject(e)&&e.name?(e=e.name.toLowerCase(),-1!==r.indexOf(e)?e:!1):_.isString(e)?(e=e.toLowerCase(),-1!==r.indexOf(e)?e:!1):!1}function i(e){return _.isObject(e)&&!_.isNull(e)&&!_.isArray(e)&&!_.isUndefined(e.type)}var n=this,r=["string","number","boolean","objectid","date"];this.check=function(r,t,d){var o=[];return _.each(t,function(t,s){var u=r[s];if(_.isArray(t)){if(!_.isArray(u))return void delete r[s];_.each(u,function(e){o=o.concat(n.check(e,t[0]))})}else if(!_.isObject(t)||_.isNull(t)||i(t)||e(t)){var f;if(i(t)?f=t.type:(f=t,t={}),_.isNull(u)&&d&&!t.required)return void(r[s]=void 0);var a=e(f);if(!a)throw new Error("type "+f+" not available");switch(a){case"string":if(!_.isString(u)&&!_.isNumber(u)||_.isNaN(u))u=void 0,t.required&&o.push(s+" - required not set on '"+u+"'");else{if(u+="",!_.isUndefined(t.minLength)&&u.length<t.minLength)return o.push(s+" - minLength "+t.minLength+" not fulfilled on '"+u+"'"),void delete r[s];if(!_.isUndefined(t.maxLength)&&u.length>t.maxLength&&(o.push(s+" - maxLength "+t.regex+" not fulfilled on '"+u+"'"),u=u.substr(0,t.maxLength)),!_.isUndefined(t.regex)&&!t.regex.test(u))return o.push(s+" - regex "+t.regex+" not fulfilled '"+u+"'"),void delete r[s]}void 0===u?delete r[s]:r[s]=u;break;case"number":if((_.isArray(u)||_.isNull(u))&&(u=void 0),u=1*u,_.isNaN(u)&&(u=void 0),t.required&&_.isUndefined(u))return o.push(s+" - required not set on '"+u+"'"),void delete r[s];if(!_.isUndefined(u)&&!_.isUndefined(t.min)&&u<t.min)return o.push(s+" - min "+t.min+" not fulfilled '"+u+"'"),void delete r[s];if(!_.isUndefined(u)&&!_.isUndefined(t.max)&&u>t.max)return o.push(s+" - max "+t.max+" not fulfilled on '"+u+"'"),void delete r[s];void 0===u?delete r[s]:r[s]=u;break;case"boolean":if(t.required&&_.isUndefined(u))return o.push(s+" - required not set '"+u+"'"),void delete r[s];if(_.isUndefined(u))return void delete r[s];r[s]=!!u;break;case"date":if(u instanceof Date&&(u=Math.floor(u.getTime()/1e3)),u=1*u,_.isNaN(u)?u=void 0:(13===u.toString().length&&(u=Math.floor(u/1e3)),10!==u.toString().length&&(u=void 0)),t.required&&_.isUndefined(u))return o.push(s+" - required not set on '"+u+"'"),void delete r[s];void 0===u?delete r[s]:r[s]=u;break;case"objectid":if(("string"!=typeof u||"string"==typeof u&&24!==u.length)&&(delete r[s],u=void 0),t.required&&_.isUndefined(u))return o.push(s+" - required not set '"+u+"'"),void delete r[s];void 0===u?delete r[s]:r[s]=u}}else{var l=n.check(u,t);o=o.concat(l)}}),o}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports=module.exports=function(e,i,n){return mongoSchema.check(e,i,n)}}
var MongoSchema=function(){function e(e){return!i(e)||f(e)||a(e.def)?void 0:e.def}function n(e){return i(e)&&e.name?(e=e.name.toLowerCase(),-1!==s.indexOf(e)?e:!1):c(e)?(e=e.toLowerCase(),-1!==s.indexOf(e)?e:!1):!1}function t(e){return i(e)&&!f(e)&&!r(e)&&!a(e.type)}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){return e===Object(e)}function o(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return o(e)&&e!=+e}function f(e){return null===e}function a(e){return void 0===e}function c(e){return"string"==typeof e||"[object String]"==Object.prototype.toString.call(e)}var d=this,s=["string","number","boolean","objectid","date"],l={string:function(){return""},number:function(){return 0},"boolean":function(){return!0},objectid:function(){return""},date:function(){return Math.floor(+new Date/1e3)}};this.check=function(e,s,l){var h,g={},m=[];for(var p in s){var v=e[p],b=s[p];if(r(b)){var x;for(var q in v){x=q;break}if(i(v)&&!r(v)&&u(parseInt(x)))h=d.check(v,b[0],l),g[p]=h.data,m=m.concat(h.errors);else if(r(v)||i(v)&&!u(parseInt(x))){g[p]=[];for(var y in v)null===v[y]&&l?g[p][y]=null:(h=d.check(v[y],b[0],l),g[p][y]=h.data,m=m.concat(h.errors))}else l||(g[p]=[])}else if(!i(b)||f(b)||t(b)||n(b)){var S;if(t(b)?S=b.type:(S=b,b={}),f(v)&&l&&!b.required){g[p]=null;continue}if(a(v)&&l)continue;var L=n(S);if(!L)throw new Error("type "+S+" not available");switch(L){case"string":if(!c(v)&&!o(v)||u(v))v=void 0,b.required&&m.push(p+" - required not set on '"+v+"'");else{if(v+="",!a(b.minLength)&&v.length<b.minLength){b.required&&m.push(p+" - minLength "+b.minLength+" not fulfilled on '"+v+"'");continue}if(!a(b.maxLength)&&v.length>b.maxLength&&(b.required&&m.push(p+" - maxLength "+b.regex+" not fulfilled on '"+v+"'"),v=v.substr(0,b.maxLength)),!a(b.regex)&&!b.regex.test(v)){b.required&&m.push(p+" - regex "+b.regex+" not fulfilled '"+v+"'");continue}}a(v)||(g[p]=v);continue;case"number":if((r(v)||f(v))&&(v=void 0),v=1*v,u(v)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}if(!a(v)&&!a(b.min)&&v<b.min){b.required&&m.push(p+" - min "+b.min+" not fulfilled '"+v+"'");continue}if(!a(v)&&!a(b.max)&&v>b.max){b.required&&m.push(p+" - max "+b.max+" not fulfilled on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"boolean":if(b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}if(a(v))continue;g[p]=!!v;continue;case"date":if(v instanceof Date&&(v=Math.floor(v.getTime()/1e3)),v=1*v,u(v)?v=void 0:(13===v.toString().length&&(v=Math.floor(v/1e3)),10!==v.toString().length&&(v=void 0)),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"objectid":if(("string"!=typeof v||"string"==typeof v&&24!==v.length)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}a(v)||(g[p]=v);continue}}else a(v)||(h=d.check(v,b,l),g[p]=h.data,m=m.concat(h.errors))}return{errors:m,data:g}},this.defs=function(o){r(o)&&1===o.length&&(o=o[0]);var u={};for(var c in o){var s=o[c];if(r(s))u[c]=[];else if(!i(s)||f(s)||t(s)||n(s)){if(s){var h;t(s)?h=s.type:(h=s,s={}),h=n(h),!s.required&&a(e(s))||a(l[h])?u[c]=void 0:(u[c]=e(s),void 0===u[c]&&(u[c]=l[h]()))}}else u[c]=d.defs(s)}return u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports.check=mongoSchema.check,exports.defs=mongoSchema.defs}var MongoSchema=function(){function e(e){return!i(e)||f(e)||a(e.default)?void 0:e.default}function n(e){return i(e)&&e.name?(e=e.name.toLowerCase(),-1!==s.indexOf(e)?e:!1):c(e)?(e=e.toLowerCase(),-1!==s.indexOf(e)?e:!1):!1}function t(e){return i(e)&&!f(e)&&!r(e)&&!a(e.type)}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){return e===Object(e)}function o(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return o(e)&&e!=+e}function f(e){return null===e}function a(e){return void 0===e}function c(e){return"string"==typeof e||"[object String]"==Object.prototype.toString.call(e)}var d=this,s=["string","number","boolean","objectid","date"],l={string:function(){return""},number:function(){return 0},"boolean":function(){return!0},objectid:function(){return""},date:function(){return Math.floor(+new Date/1e3)}};this.check=function(e,s,l){var h,g={},m=[];for(var p in s){var v=e[p],b=s[p];if(r(b))if(i(v)&&!r(v))h=d.check(v,b[0],l),g[p]=h.data,m=m.concat(h.errors);else if(r(v)){g[p]=[];for(var x in v)null===v[x]&&l?g[p][x]=null:(h=d.check(v[x],b[0],l),g[p][x]=h.data,m=m.concat(h.errors))}else l||(g[p]=[]);else if(!i(b)||f(b)||t(b)||n(b)){var q;if(t(b)?q=b.type:(q=b,b={}),f(v)&&l&&!b.required){g[p]=null;continue}if(a(v)&&l)continue;var y=n(q);if(!y)throw new Error("type "+q+" not available");switch(y){case"string":if(!c(v)&&!o(v)||u(v))v=void 0,b.required&&m.push(p+" - required not set on '"+v+"'");else{if(v+="",!a(b.minLength)&&v.length<b.minLength){b.required&&m.push(p+" - minLength "+b.minLength+" not fulfilled on '"+v+"'");continue}if(!a(b.maxLength)&&v.length>b.maxLength&&(b.required&&m.push(p+" - maxLength "+b.regex+" not fulfilled on '"+v+"'"),v=v.substr(0,b.maxLength)),!a(b.regex)&&!b.regex.test(v)){b.required&&m.push(p+" - regex "+b.regex+" not fulfilled '"+v+"'");continue}}a(v)||(g[p]=v);continue;case"number":if((r(v)||f(v))&&(v=void 0),v=1*v,u(v)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}if(!a(v)&&!a(b.min)&&v<b.min){b.required&&m.push(p+" - min "+b.min+" not fulfilled '"+v+"'");continue}if(!a(v)&&!a(b.max)&&v>b.max){b.required&&m.push(p+" - max "+b.max+" not fulfilled on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"boolean":if(b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}if(a(v))continue;g[p]=!!v;continue;case"date":if(v instanceof Date&&(v=Math.floor(v.getTime()/1e3)),v=1*v,u(v)?v=void 0:(13===v.toString().length&&(v=Math.floor(v/1e3)),10!==v.toString().length&&(v=void 0)),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"objectid":if(("string"!=typeof v||"string"==typeof v&&24!==v.length)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}a(v)||(g[p]=v);continue}}else a(v)||(h=d.check(v,b,l),g[p]=h.data,m=m.concat(h.errors))}return{errors:m,data:g}},this.defaults=function(o){r(o)&&1===o.length&&(o=o[0]);var u={};for(var c in o){var s=o[c];if(r(s))u[c]=[];else if(!i(s)||f(s)||t(s)||n(s)){if(s){var h;t(s)?h=s.type:(h=s,s={}),h=n(h),u[c]=!s.required&&a(e(s))||a(l[h])?void 0:e(s)||l[h]()}}else u[c]=d.defaults(s)}return u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports.check=mongoSchema.check,exports.defaults=mongoSchema.defaults}var MongoSchema=function(){function e(e){return!i(e)||f(e)||a(e.default)?void 0:e.default}function n(e){return i(e)&&e.name?(e=e.name.toLowerCase(),-1!==s.indexOf(e)?e:!1):c(e)?(e=e.toLowerCase(),-1!==s.indexOf(e)?e:!1):!1}function t(e){return i(e)&&!f(e)&&!r(e)&&!a(e.type)}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){return e===Object(e)}function o(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return o(e)&&e!=+e}function f(e){return null===e}function a(e){return void 0===e}function c(e){return"string"==typeof e||"[object String]"==Object.prototype.toString.call(e)}var d=this,s=["string","number","boolean","objectid","date"],l={string:function(){return""},number:function(){return 0},"boolean":function(){return!0},objectid:function(){return""},date:function(){return Math.floor(+new Date/1e3)}};this.check=function(e,s,l){var h,g={},m=[];for(var p in s){var v=e[p],b=s[p];if(r(b))if(i(v)&&!r(v))h=d.check(v,b[0],l),g[p]=h.data,m=m.concat(h.errors);else if(r(v)){g[p]=[];for(var x in v)null===v[x]&&l?g[p][x]=null:(h=d.check(v[x],b[0],l),g[p][x]=h.data,m=m.concat(h.errors))}else l||(g[p]=[]);else if(!i(b)||f(b)||t(b)||n(b)){var q;if(t(b)?q=b.type:(q=b,b={}),f(v)&&l&&!b.required){g[p]=null;continue}if(a(v)&&l)continue;var y=n(q);if(!y)throw new Error("type "+q+" not available");switch(y){case"string":if(!c(v)&&!o(v)||u(v))v=void 0,b.required&&m.push(p+" - required not set on '"+v+"'");else{if(v+="",!a(b.minLength)&&v.length<b.minLength){b.required&&m.push(p+" - minLength "+b.minLength+" not fulfilled on '"+v+"'");continue}if(!a(b.maxLength)&&v.length>b.maxLength&&(b.required&&m.push(p+" - maxLength "+b.regex+" not fulfilled on '"+v+"'"),v=v.substr(0,b.maxLength)),!a(b.regex)&&!b.regex.test(v)){b.required&&m.push(p+" - regex "+b.regex+" not fulfilled '"+v+"'");continue}}a(v)||(g[p]=v);continue;case"number":if((r(v)||f(v))&&(v=void 0),v=1*v,u(v)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}if(!a(v)&&!a(b.min)&&v<b.min){b.required&&m.push(p+" - min "+b.min+" not fulfilled '"+v+"'");continue}if(!a(v)&&!a(b.max)&&v>b.max){b.required&&m.push(p+" - max "+b.max+" not fulfilled on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"boolean":if(b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}if(a(v))continue;g[p]=!!v;continue;case"date":if(v instanceof Date&&(v=Math.floor(v.getTime()/1e3)),v=1*v,u(v)?v=void 0:(13===v.toString().length&&(v=Math.floor(v/1e3)),10!==v.toString().length&&(v=void 0)),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"objectid":if(("string"!=typeof v||"string"==typeof v&&24!==v.length)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}a(v)||(g[p]=v);continue}}else a(v)||(h=d.check(v,b,l),g[p]=h.data,m=m.concat(h.errors))}return{errors:m,data:g}},this.defaults=function(o){var u={};for(var c in o){var s=o[c];if(r(s))u[c]=[];else if(!i(s)||f(s)||t(s)||n(s)){if(s){var h;t(s)?h=s.type:(h=s,s={}),h=n(h),u[c]=!s.required&&a(e(s))||a(l[h])?void 0:e(s)||l[h]()}}else u[c]=d.defaults(s)}return u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports.check=mongoSchema.check,exports.defaults=mongoSchema.defaults}var MongoSchema=function(){function e(e){return!i(e)||f(e)||a(e.default)?void 0:e.default}function n(e){return i(e)&&e.name?(e=e.name.toLowerCase(),-1!==s.indexOf(e)?e:!1):c(e)?(e=e.toLowerCase(),-1!==s.indexOf(e)?e:!1):!1}function t(e){return i(e)&&!f(e)&&!r(e)&&!a(e.type)}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){return e===Object(e)}function o(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return o(e)&&e!=+e}function f(e){return null===e}function a(e){return void 0===e}function c(e){return"string"==typeof e||"[object String]"==Object.prototype.toString.call(e)}var d=this,s=["string","number","boolean","objectid","date"],l={string:function(){return""},number:function(){return 0},"boolean":function(){return!0},objectid:function(){return""},date:function(){return Math.floor(+new Date/1e3)}};this.check=function(e,s,l){var h,g={},m=[];for(var p in s){var v=e[p],b=s[p];if(r(b))if(i(v)&&!r(v))h=d.check(v,b[0],l),g[p]=h.data,m=m.concat(h.errors);else if(r(v)){g[p]=[];for(var x in v)null===v[x]&&l||(h=d.check(v[x],b[0],l),g[p][x]=h.data,m=m.concat(h.errors))}else l||(g[p]=[]);else if(!i(b)||f(b)||t(b)||n(b)){var q;if(t(b)?q=b.type:(q=b,b={}),f(v)&&l&&!b.required){g[p]=null;continue}if(a(v)&&l)continue;var y=n(q);if(!y)throw new Error("type "+q+" not available");switch(y){case"string":if(!c(v)&&!o(v)||u(v))v=void 0,b.required&&m.push(p+" - required not set on '"+v+"'");else{if(v+="",!a(b.minLength)&&v.length<b.minLength){b.required&&m.push(p+" - minLength "+b.minLength+" not fulfilled on '"+v+"'");continue}if(!a(b.maxLength)&&v.length>b.maxLength&&(b.required&&m.push(p+" - maxLength "+b.regex+" not fulfilled on '"+v+"'"),v=v.substr(0,b.maxLength)),!a(b.regex)&&!b.regex.test(v)){b.required&&m.push(p+" - regex "+b.regex+" not fulfilled '"+v+"'");continue}}a(v)||(g[p]=v);continue;case"number":if((r(v)||f(v))&&(v=void 0),v=1*v,u(v)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}if(!a(v)&&!a(b.min)&&v<b.min){b.required&&m.push(p+" - min "+b.min+" not fulfilled '"+v+"'");continue}if(!a(v)&&!a(b.max)&&v>b.max){b.required&&m.push(p+" - max "+b.max+" not fulfilled on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"boolean":if(b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}if(a(v))continue;g[p]=!!v;continue;case"date":if(v instanceof Date&&(v=Math.floor(v.getTime()/1e3)),v=1*v,u(v)?v=void 0:(13===v.toString().length&&(v=Math.floor(v/1e3)),10!==v.toString().length&&(v=void 0)),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"objectid":if(("string"!=typeof v||"string"==typeof v&&24!==v.length)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}a(v)||(g[p]=v);continue}}else a(v)||(h=d.check(v,b,l),g[p]=h.data,m=m.concat(h.errors))}return{errors:m,data:g}},this.defaults=function(o){var u={};for(var c in o){var s=o[c];if(r(s))u[c]=[];else if(!i(s)||f(s)||t(s)||n(s)){if(s){var h;t(s)?h=s.type:(h=s,s={}),h=n(h),u[c]=!s.required&&a(e(s))||a(l[h])?void 0:e(s)||l[h]()}}else u[c]=d.defaults(s)}return u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports.check=mongoSchema.check,exports.defaults=mongoSchema.defaults}var MongoSchema=function(){function e(e){return!i(e)||f(e)||a(e.default)?void 0:e.default}function n(e){return i(e)&&e.name?(e=e.name.toLowerCase(),-1!==s.indexOf(e)?e:!1):c(e)?(e=e.toLowerCase(),-1!==s.indexOf(e)?e:!1):!1}function t(e){return i(e)&&!f(e)&&!r(e)&&!a(e.type)}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){return e===Object(e)}function o(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return o(e)&&e!=+e}function f(e){return null===e}function a(e){return void 0===e}function c(e){return"string"==typeof e||"[object String]"==Object.prototype.toString.call(e)}var d=this,s=["string","number","boolean","objectid","date"],l={string:function(){return""},number:function(){return 0},"boolean":function(){return!0},objectid:function(){return""},date:function(){return Math.floor(+new Date/1e3)}};this.check=function(e,s,l){var h,g={},m=[];for(var p in s)if(s.hasOwnProperty(p)){var v=e[p],b=s[p];if(r(b))if(i(v)&&!r(v))h=d.check(v,b[0],l),g[p]=h.data,m=m.concat(h.errors);else if(r(v)){g[p]=[];for(var x in v)v.hasOwnProperty(x)&&(h=d.check(v[x],b[0],l),g[p][x]=h.data,m=m.concat(h.errors))}else l||(g[p]=[]);else if(!i(b)||f(b)||t(b)||n(b)){var q;if(t(b)?q=b.type:(q=b,b={}),f(v)&&l&&!b.required){g[p]=null;continue}if(a(v)&&l&&!b.required)continue;var y=n(q);if(!y)throw new Error("type "+q+" not available");switch(y){case"string":if(!c(v)&&!o(v)||u(v))v=void 0,b.required&&m.push(p+" - required not set on '"+v+"'");else{if(v+="",!a(b.minLength)&&v.length<b.minLength){b.required&&m.push(p+" - minLength "+b.minLength+" not fulfilled on '"+v+"'");continue}if(!a(b.maxLength)&&v.length>b.maxLength&&(b.required&&m.push(p+" - maxLength "+b.regex+" not fulfilled on '"+v+"'"),v=v.substr(0,b.maxLength)),!a(b.regex)&&!b.regex.test(v)){b.required&&m.push(p+" - regex "+b.regex+" not fulfilled '"+v+"'");continue}}a(v)||(g[p]=v);continue;case"number":if((r(v)||f(v))&&(v=void 0),v=1*v,u(v)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}if(!a(v)&&!a(b.min)&&v<b.min){b.required&&m.push(p+" - min "+b.min+" not fulfilled '"+v+"'");continue}if(!a(v)&&!a(b.max)&&v>b.max){b.required&&m.push(p+" - max "+b.max+" not fulfilled on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"boolean":if(b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}if(a(v))continue;g[p]=!!v;continue;case"date":if(v instanceof Date&&(v=Math.floor(v.getTime()/1e3)),v=1*v,u(v)?v=void 0:(13===v.toString().length&&(v=Math.floor(v/1e3)),10!==v.toString().length&&(v=void 0)),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"objectid":if(("string"!=typeof v||"string"==typeof v&&24!==v.length)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}a(v)||(g[p]=v);continue}}else a(v)||(h=d.check(v,b,l),g[p]=h.data,m=m.concat(h.errors))}return{errors:m,data:g}},this.defaults=function(o){var u={};for(var c in o)if(o.hasOwnProperty(c)){var s=o[c];if(r(s))u[c]=[];else if(!i(s)||f(s)||t(s)||n(s)){if(s){var h;t(s)?h=s.type:(h=s,s={}),h=n(h),u[c]=!s.required&&a(e(s))||a(l[h])?void 0:e(s)||l[h]()}}else u[c]=d.defaults(s)}return u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports.check=mongoSchema.check,exports.defaults=mongoSchema.defaults}var MongoSchema=function(){function e(e){return!i(e)||f(e)||a(e.default)?void 0:e.default}function n(e){return i(e)&&e.name?(e=e.name.toLowerCase(),-1!==s.indexOf(e)?e:!1):c(e)?(e=e.toLowerCase(),-1!==s.indexOf(e)?e:!1):!1}function t(e){return i(e)&&!f(e)&&!r(e)&&!a(e.type)}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){return e===Object(e)}function o(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return o(e)&&e!=+e}function f(e){return null===e}function a(e){return void 0===e}function c(e){return"string"==typeof e||"[object String]"==Object.prototype.toString.call(e)}var d=this,s=["string","number","boolean","objectid","date"],l={string:function(){return""},number:function(){return 0},"boolean":function(){return!0},objectid:function(){return""},date:function(){return Math.floor(+new Date/1e3)}};this.check=function(e,s,l){var h,g={},m=[];for(var p in s)if(s.hasOwnProperty(p)){var v=e[p],b=s[p];if(r(b)){if(g[p]=[],r(v))for(var x in v)v.hasOwnProperty(x)&&(h=d.check(v[x],b[0]),g[p][x]=h.data,m=m.concat(h.errors))}else if(!i(b)||f(b)||t(b)||n(b)){var q;if(t(b)?q=b.type:(q=b,b={}),f(v)&&l&&!b.required){g[p]=void 0;continue}var y=n(q);if(!y)throw new Error("type "+q+" not available");switch(y){case"string":if(!c(v)&&!o(v)||u(v))v=void 0,b.required&&m.push(p+" - required not set on '"+v+"'");else{if(v+="",!a(b.minLength)&&v.length<b.minLength){b.required&&m.push(p+" - minLength "+b.minLength+" not fulfilled on '"+v+"'");continue}if(!a(b.maxLength)&&v.length>b.maxLength&&(b.required&&m.push(p+" - maxLength "+b.regex+" not fulfilled on '"+v+"'"),v=v.substr(0,b.maxLength)),!a(b.regex)&&!b.regex.test(v)){b.required&&m.push(p+" - regex "+b.regex+" not fulfilled '"+v+"'");continue}}a(v)||(g[p]=v);continue;case"number":if((r(v)||f(v))&&(v=void 0),v=1*v,u(v)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}if(!a(v)&&!a(b.min)&&v<b.min){b.required&&m.push(p+" - min "+b.min+" not fulfilled '"+v+"'");continue}if(!a(v)&&!a(b.max)&&v>b.max){b.required&&m.push(p+" - max "+b.max+" not fulfilled on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"boolean":if(b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}if(a(v))continue;g[p]=!!v;continue;case"date":if(v instanceof Date&&(v=Math.floor(v.getTime()/1e3)),v=1*v,u(v)?v=void 0:(13===v.toString().length&&(v=Math.floor(v/1e3)),10!==v.toString().length&&(v=void 0)),b.required&&a(v)){m.push(p+" - required not set on '"+v+"'");continue}a(v)||(g[p]=v);continue;case"objectid":if(("string"!=typeof v||"string"==typeof v&&24!==v.length)&&(v=void 0),b.required&&a(v)){m.push(p+" - required not set '"+v+"'");continue}a(v)||(g[p]=v);continue}}else a(v)||(h=d.check(v,b),g[p]=h.data,m=m.concat(h.errors))}return{errors:m,data:g}},this.defaults=function(o){var u={};for(var c in o)if(o.hasOwnProperty(c)){var s=o[c];if(r(s))u[c]=[];else if(!i(s)||f(s)||t(s)||n(s)){if(s){var h;t(s)?h=s.type:(h=s,s={}),h=n(h),u[c]=!s.required&&a(e(s))||a(l[h])?void 0:e(s)||l[h]()}}else u[c]=d.defaults(s)}return u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports.check=mongoSchema.check,exports.defaults=mongoSchema.defaults}var has_require="undefined"!=typeof require;if("undefined"==typeof _){if(!has_require)throw new Error("mymodule requires underscore, see http://underscorejs.org");_=require("underscore")._}var MongoSchema=function(){function e(e){return _.isObject(e)&&e.name?(e=e.name.toLowerCase(),-1!==r.indexOf(e)?e:!1):_.isString(e)?(e=e.toLowerCase(),-1!==r.indexOf(e)?e:!1):!1}function n(e){return _.isObject(e)&&!_.isNull(e)&&!_.isArray(e)&&!_.isUndefined(e.type)}var t=this,r=["string","number","boolean","objectid","date"];this.check=function(r,i,o){var u=[];return _.each(i,function(i,f){var a=r[f];if(_.isArray(i)){if(!_.isArray(a))return void delete r[f];_.each(a,function(e){u=u.concat(t.check(e,i[0]))})}else if(!_.isObject(i)||_.isNull(i)||n(i)||e(i)){var c;if(n(i)?c=i.type:(c=i,i={}),_.isNull(a)&&o&&!i.required)return void(r[f]=void 0);var d=e(c);if(!d)throw new Error("type "+c+" not available");switch(d){case"string":if(!_.isString(a)&&!_.isNumber(a)||_.isNaN(a))a=void 0,i.required&&u.push(f+" - required not set on '"+a+"'");else{if(a+="",!_.isUndefined(i.minLength)&&a.length<i.minLength)return u.push(f+" - minLength "+i.minLength+" not fulfilled on '"+a+"'"),void delete r[f];if(!_.isUndefined(i.maxLength)&&a.length>i.maxLength&&(u.push(f+" - maxLength "+i.regex+" not fulfilled on '"+a+"'"),a=a.substr(0,i.maxLength)),!_.isUndefined(i.regex)&&!i.regex.test(a))return u.push(f+" - regex "+i.regex+" not fulfilled '"+a+"'"),void delete r[f]}void 0===a?delete r[f]:r[f]=a;break;case"number":if((_.isArray(a)||_.isNull(a))&&(a=void 0),a=1*a,_.isNaN(a)&&(a=void 0),i.required&&_.isUndefined(a))return u.push(f+" - required not set on '"+a+"'"),void delete r[f];if(!_.isUndefined(a)&&!_.isUndefined(i.min)&&a<i.min)return u.push(f+" - min "+i.min+" not fulfilled '"+a+"'"),void delete r[f];if(!_.isUndefined(a)&&!_.isUndefined(i.max)&&a>i.max)return u.push(f+" - max "+i.max+" not fulfilled on '"+a+"'"),void delete r[f];void 0===a?delete r[f]:r[f]=a;break;case"boolean":if(i.required&&_.isUndefined(a))return u.push(f+" - required not set '"+a+"'"),void delete r[f];if(_.isUndefined(a))return void delete r[f];r[f]=!!a;break;case"date":if(a instanceof Date&&(a=Math.floor(a.getTime()/1e3)),a=1*a,_.isNaN(a)?a=void 0:(13===a.toString().length&&(a=Math.floor(a/1e3)),10!==a.toString().length&&(a=void 0)),i.required&&_.isUndefined(a))return u.push(f+" - required not set on '"+a+"'"),void delete r[f];void 0===a?delete r[f]:r[f]=a;break;case"objectid":if(("string"!=typeof a||"string"==typeof a&&24!==a.length)&&(delete r[f],a=void 0),i.required&&_.isUndefined(a))return u.push(f+" - required not set '"+a+"'"),void delete r[f];void 0===a?delete r[f]:r[f]=a}}else{var s=t.check(a,i);u=u.concat(s)}}),u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports=module.exports=function(e,n,t){return mongoSchema.check(e,n,t)}}var has_require="undefined"!=typeof require;if("undefined"==typeof _){if(!has_require)throw new Error("mymodule requires underscore, see http://underscorejs.org");_=require("underscore")._}var MongoSchema=function(){function e(e){return _.isObject(e)&&e.name?(e=e.name.toLowerCase(),-1!==r.indexOf(e)?e:!1):_.isString(e)?(e=e.toLowerCase(),-1!==r.indexOf(e)?e:!1):!1}function n(e){return _.isObject(e)&&!_.isNull(e)&&!_.isArray(e)&&!_.isUndefined(e.type)}var t=this,r=["string","number","boolean","objectid","date"];this.check=function(r,i,o){var u=[];return _.each(i,function(i,f){var a=r[f];if(_.isArray(i)){if(!_.isArray(a))return void delete r[f];_.each(a,function(e){u=u.concat(t.check(e,i[0]))})}else if(!_.isObject(i)||_.isNull(i)||n(i)||e(i)){var c;if(n(i)?c=i.type:(c=i,i={}),_.isNull(a)&&o&&!i.required)return void(r[f]=void 0);var d=e(c);if(!d)throw new Error("type "+c+" not available");switch(d){case"string":if(!_.isString(a)&&!_.isNumber(a)||_.isNaN(a))a=void 0,i.required&&u.push(f+" - required not set on '"+a+"'");else{if(a+="",!_.isUndefined(i.minLength)&&a.length<i.minLength)return u.push(f+" - minLength "+i.minLength+" not fulfilled on '"+a+"'"),void delete r[f];if(!_.isUndefined(i.maxLength)&&a.length>i.maxLength&&(u.push(f+" - maxLength "+i.regex+" not fulfilled on '"+a+"'"),a=a.substr(0,i.maxLength)),!_.isUndefined(i.regex)&&!i.regex.test(a))return u.push(f+" - regex "+i.regex+" not fulfilled '"+a+"'"),void delete r[f]}void 0===a?delete r[f]:r[f]=a;break;case"number":if((_.isArray(a)||_.isNull(a))&&(a=void 0),a=1*a,_.isNaN(a)&&(a=void 0),i.required&&_.isUndefined(a))return u.push(f+" - required not set on '"+a+"'"),void delete r[f];if(!_.isUndefined(a)&&!_.isUndefined(i.min)&&a<i.min)return u.push(f+" - min "+i.min+" not fulfilled '"+a+"'"),void delete r[f];if(!_.isUndefined(a)&&!_.isUndefined(i.max)&&a>i.max)return u.push(f+" - max "+i.max+" not fulfilled on '"+a+"'"),void delete r[f];void 0===a?delete r[f]:r[f]=a;break;case"boolean":if(i.required&&_.isUndefined(a))return u.push(f+" - required not set '"+a+"'"),void delete r[f];if(_.isUndefined(a))return void delete r[f];r[f]=!!a;break;case"date":if(a instanceof Date&&(a=Math.floor(a.getTime()/1e3)),a=1*a,_.isNaN(a)?a=void 0:(13===a.toString().length&&(a=Math.floor(a/1e3)),10!==a.toString().length&&(a=void 0)),i.required&&_.isUndefined(a))return u.push(f+" - required not set on '"+a+"'"),void delete r[f];void 0===a?delete r[f]:r[f]=a;break;case"objectid":if(("string"!=typeof a||"string"==typeof a&&24!==a.length)&&(delete r[f],a=void 0),i.required&&_.isUndefined(a))return u.push(f+" - required not set '"+a+"'"),void delete r[f];void 0===a?delete r[f]:r[f]=a}}else{var s=t.check(a,i);u=u.concat(s)}}),u}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports=module.exports=function(e,n,t){return mongoSchema.check(e,n,t)}}
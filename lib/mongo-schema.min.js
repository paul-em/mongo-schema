var MongoSchema=function(){function e(e){return!r(e)||u(e)||s(e.default)?void 0:e.default}function n(e){return r(e)&&e.name?(e=e.name.toLowerCase(),-1!==l.indexOf(e)?e:!1):f(e)?(e=e.toLowerCase(),-1!==l.indexOf(e)?e:!1):!1}function i(e){return r(e)&&!u(e)&&!t(e)&&!s(e.type)}function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){return e===Object(e)}function o(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function d(e){return o(e)&&e!=+e}function u(e){return null===e}function s(e){return void 0===e}function f(e){return"string"==typeof e||"[object String]"==Object.prototype.toString.call(e)}var a=this,l=["string","number","boolean","objectid","date"],c={string:function(){return""},number:function(){return 0},"boolean":function(){return!0},objectid:function(){return""},date:function(){return Math.floor(+new Date/1e3)}};this.check=function(e,l,c){var h,g={},m=[];for(var v in l)if(l.hasOwnProperty(v)){var p=e[v],_=l[v];if(t(_)){if(g[v]=[],t(p))for(var x in p)p.hasOwnProperty(x)&&(h=a.check(p[x],_[0]),g[v][x]=h.data,m=m.concat(h.errors))}else if(!r(_)||u(_)||i(_)||n(_)){var b;if(i(_)?b=_.type:(b=_,_={}),u(p)&&c&&!_.required){g[v]=void 0;continue}var q=n(b);if(!q)throw new Error("type "+b+" not available");switch(q){case"string":if(!f(p)&&!o(p)||d(p))p=void 0,_.required&&m.push(v+" - required not set on '"+p+"'");else{if(p+="",!s(_.minLength)&&p.length<_.minLength){_.required&&m.push(v+" - minLength "+_.minLength+" not fulfilled on '"+p+"'");continue}if(!s(_.maxLength)&&p.length>_.maxLength&&(_.required&&m.push(v+" - maxLength "+_.regex+" not fulfilled on '"+p+"'"),p=p.substr(0,_.maxLength)),!s(_.regex)&&!_.regex.test(p)){_.required&&m.push(v+" - regex "+_.regex+" not fulfilled '"+p+"'");continue}}s(p)||(g[v]=p);continue;case"number":if((t(p)||u(p))&&(p=void 0),p=1*p,d(p)&&(p=void 0),_.required&&s(p)){m.push(v+" - required not set on '"+p+"'");continue}if(!s(p)&&!s(_.min)&&p<_.min){_.required&&m.push(v+" - min "+_.min+" not fulfilled '"+p+"'");continue}if(!s(p)&&!s(_.max)&&p>_.max){_.required&&m.push(v+" - max "+_.max+" not fulfilled on '"+p+"'");continue}s(p)||(g[v]=p);continue;case"boolean":if(_.required&&s(p)){m.push(v+" - required not set '"+p+"'");continue}if(s(p))continue;g[v]=!!p;continue;case"date":if(p instanceof Date&&(p=Math.floor(p.getTime()/1e3)),p=1*p,d(p)?p=void 0:(13===p.toString().length&&(p=Math.floor(p/1e3)),10!==p.toString().length&&(p=void 0)),_.required&&s(p)){m.push(v+" - required not set on '"+p+"'");continue}s(p)||(g[v]=p);continue;case"objectid":if(("string"!=typeof p||"string"==typeof p&&24!==p.length)&&(p=void 0),_.required&&s(p)){m.push(v+" - required not set '"+p+"'");continue}s(p)||(g[v]=p);continue}}else s(p)||(h=a.check(p,_),g[v]=h.data,m=m.concat(h.errors))}return{errors:m,data:g}},this.defaults=function(o){var d={};for(var f in o)if(o.hasOwnProperty(f)){var l=o[f];if(t(l))d[f]=[];else if(!r(l)||u(l)||i(l)||n(l)){if(l){var h;i(l)?h=l.type:(h=l,l={}),h=n(h),d[f]=!l.required&&s(e(l))||s(c[h])?void 0:e(l)||c[h]()}}else d[f]=a.defaults(l)}return d}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports.check=mongoSchema.check,exports.defaults=mongoSchema.defaults}var has_require="undefined"!=typeof require;if("undefined"==typeof _){if(!has_require)throw new Error("mymodule requires underscore, see http://underscorejs.org");_=require("underscore")._}var MongoSchema=function(){function e(e){return _.isObject(e)&&e.name?(e=e.name.toLowerCase(),-1!==t.indexOf(e)?e:!1):_.isString(e)?(e=e.toLowerCase(),-1!==t.indexOf(e)?e:!1):!1}function n(e){return _.isObject(e)&&!_.isNull(e)&&!_.isArray(e)&&!_.isUndefined(e.type)}var i=this,t=["string","number","boolean","objectid","date"];this.check=function(t,r,o){var d=[];return _.each(r,function(r,u){var s=t[u];if(_.isArray(r)){if(!_.isArray(s))return void delete t[u];_.each(s,function(e){d=d.concat(i.check(e,r[0]))})}else if(!_.isObject(r)||_.isNull(r)||n(r)||e(r)){var f;if(n(r)?f=r.type:(f=r,r={}),_.isNull(s)&&o&&!r.required)return void(t[u]=void 0);var a=e(f);if(!a)throw new Error("type "+f+" not available");switch(a){case"string":if(!_.isString(s)&&!_.isNumber(s)||_.isNaN(s))s=void 0,r.required&&d.push(u+" - required not set on '"+s+"'");else{if(s+="",!_.isUndefined(r.minLength)&&s.length<r.minLength)return d.push(u+" - minLength "+r.minLength+" not fulfilled on '"+s+"'"),void delete t[u];if(!_.isUndefined(r.maxLength)&&s.length>r.maxLength&&(d.push(u+" - maxLength "+r.regex+" not fulfilled on '"+s+"'"),s=s.substr(0,r.maxLength)),!_.isUndefined(r.regex)&&!r.regex.test(s))return d.push(u+" - regex "+r.regex+" not fulfilled '"+s+"'"),void delete t[u]}void 0===s?delete t[u]:t[u]=s;break;case"number":if((_.isArray(s)||_.isNull(s))&&(s=void 0),s=1*s,_.isNaN(s)&&(s=void 0),r.required&&_.isUndefined(s))return d.push(u+" - required not set on '"+s+"'"),void delete t[u];if(!_.isUndefined(s)&&!_.isUndefined(r.min)&&s<r.min)return d.push(u+" - min "+r.min+" not fulfilled '"+s+"'"),void delete t[u];if(!_.isUndefined(s)&&!_.isUndefined(r.max)&&s>r.max)return d.push(u+" - max "+r.max+" not fulfilled on '"+s+"'"),void delete t[u];void 0===s?delete t[u]:t[u]=s;break;case"boolean":if(r.required&&_.isUndefined(s))return d.push(u+" - required not set '"+s+"'"),void delete t[u];if(_.isUndefined(s))return void delete t[u];t[u]=!!s;break;case"date":if(s instanceof Date&&(s=Math.floor(s.getTime()/1e3)),s=1*s,_.isNaN(s)?s=void 0:(13===s.toString().length&&(s=Math.floor(s/1e3)),10!==s.toString().length&&(s=void 0)),r.required&&_.isUndefined(s))return d.push(u+" - required not set on '"+s+"'"),void delete t[u];void 0===s?delete t[u]:t[u]=s;break;case"objectid":if(("string"!=typeof s||"string"==typeof s&&24!==s.length)&&(delete t[u],s=void 0),r.required&&_.isUndefined(s))return d.push(u+" - required not set '"+s+"'"),void delete t[u];void 0===s?delete t[u]:t[u]=s}}else{var l=i.check(s,r);d=d.concat(l)}}),d}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports=module.exports=function(e,n,i){return mongoSchema.check(e,n,i)}}var has_require="undefined"!=typeof require;if("undefined"==typeof _){if(!has_require)throw new Error("mymodule requires underscore, see http://underscorejs.org");_=require("underscore")._}var MongoSchema=function(){function e(e){return _.isObject(e)&&e.name?(e=e.name.toLowerCase(),-1!==t.indexOf(e)?e:!1):_.isString(e)?(e=e.toLowerCase(),-1!==t.indexOf(e)?e:!1):!1}function n(e){return _.isObject(e)&&!_.isNull(e)&&!_.isArray(e)&&!_.isUndefined(e.type)}var i=this,t=["string","number","boolean","objectid","date"];this.check=function(t,r,o){var d=[];return _.each(r,function(r,u){var s=t[u];if(_.isArray(r)){if(!_.isArray(s))return void delete t[u];_.each(s,function(e){d=d.concat(i.check(e,r[0]))})}else if(!_.isObject(r)||_.isNull(r)||n(r)||e(r)){var f;if(n(r)?f=r.type:(f=r,r={}),_.isNull(s)&&o&&!r.required)return void(t[u]=void 0);var a=e(f);if(!a)throw new Error("type "+f+" not available");switch(a){case"string":if(!_.isString(s)&&!_.isNumber(s)||_.isNaN(s))s=void 0,r.required&&d.push(u+" - required not set on '"+s+"'");else{if(s+="",!_.isUndefined(r.minLength)&&s.length<r.minLength)return d.push(u+" - minLength "+r.minLength+" not fulfilled on '"+s+"'"),void delete t[u];if(!_.isUndefined(r.maxLength)&&s.length>r.maxLength&&(d.push(u+" - maxLength "+r.regex+" not fulfilled on '"+s+"'"),s=s.substr(0,r.maxLength)),!_.isUndefined(r.regex)&&!r.regex.test(s))return d.push(u+" - regex "+r.regex+" not fulfilled '"+s+"'"),void delete t[u]}void 0===s?delete t[u]:t[u]=s;break;case"number":if((_.isArray(s)||_.isNull(s))&&(s=void 0),s=1*s,_.isNaN(s)&&(s=void 0),r.required&&_.isUndefined(s))return d.push(u+" - required not set on '"+s+"'"),void delete t[u];if(!_.isUndefined(s)&&!_.isUndefined(r.min)&&s<r.min)return d.push(u+" - min "+r.min+" not fulfilled '"+s+"'"),void delete t[u];if(!_.isUndefined(s)&&!_.isUndefined(r.max)&&s>r.max)return d.push(u+" - max "+r.max+" not fulfilled on '"+s+"'"),void delete t[u];void 0===s?delete t[u]:t[u]=s;break;case"boolean":if(r.required&&_.isUndefined(s))return d.push(u+" - required not set '"+s+"'"),void delete t[u];if(_.isUndefined(s))return void delete t[u];t[u]=!!s;break;case"date":if(s instanceof Date&&(s=Math.floor(s.getTime()/1e3)),s=1*s,_.isNaN(s)?s=void 0:(13===s.toString().length&&(s=Math.floor(s/1e3)),10!==s.toString().length&&(s=void 0)),r.required&&_.isUndefined(s))return d.push(u+" - required not set on '"+s+"'"),void delete t[u];void 0===s?delete t[u]:t[u]=s;break;case"objectid":if(("string"!=typeof s||"string"==typeof s&&24!==s.length)&&(delete t[u],s=void 0),r.required&&_.isUndefined(s))return d.push(u+" - required not set '"+s+"'"),void delete t[u];void 0===s?delete t[u]:t[u]=s}}else{var l=i.check(s,r);d=d.concat(l)}}),d}};if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports){var mongoSchema=new MongoSchema;exports=module.exports=function(e,n,i){return mongoSchema.check(e,n,i)}}